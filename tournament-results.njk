---
permalink: "tournament-results/index.html"
---
{% extends "layout.njk" %}

<meta name="description" content="Official tournament results for Fighting Game Community (FGC) Street Fighter tournaments. Browse player finishes, view event dates, and filter by player name or event.">

{% block content %}
<style>
/* --- Desktop-First Styles (Default for all screens) --- */
.content-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0.3rem 1rem 2rem 1rem;
    color: #f0f0f0;
    font-family: 'Inter', sans-serif;
}

.content-container h1 {
    margin-top: 0;
    color: #FF5E13;
    font-family: 'Permanent Marker', cursive;
    font-size: 3rem;
    text-align: center;
}

.content-container .controls-container {
    display: flex;
    justify-content: center;
    margin-bottom: 1.5rem;
}

.content-container #search-input {
    width: 100%;
    max-width: 400px;
    padding: 0.75rem;
    font-size: 1rem;
    border-radius: 8px;
    border: 1px solid #666;
    background-color: #333;
    color: #fff;
    outline: none;
    text-align: center;
    transition: background-color 0.3s, border-color 0.3s;
}

.content-container #search-input:focus {
    background-color: #444;
    border-color: #FF5E13;
}

.content-container #search-input::placeholder {
    color: #d4d4d4;
    transition: color 0.3s;
}

.content-container .table-wrapper {
    overflow-x: auto;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
}

.content-container #tournament-results-table {
    width: 100%;
    border-collapse: collapse;
    font-family: Arial, sans-serif;
    table-layout: auto;
}

.content-container #tournament-results-table thead th {
    background-color: transparent;
    color: #ffffff;
    padding: 1.2rem 1rem;
    text-align: center;
    font-weight: bold;
    cursor: pointer;
    border-bottom: 2px solid #444;
    transition: background-color 0.2s;
    position: relative;
    white-space: nowrap;
}

.content-container #tournament-results-table thead th:hover {
    background-color: rgba(255, 255, 255, 0.05);
}

/* Updated styling for the sort icons to match the user's image and make them larger */
.content-container #tournament-results-table thead th .sort-icon {
    display: inline-flex; /* Use flexbox to align up and down arrows */
    flex-direction: column;
    justify-content: center;
    align-items: center;
    margin-left: 0.5rem;
    width: 24px; /* Increased width to make the icon bigger */
    height: 24px; /* Increased height to make the icon bigger */
    transition: opacity 0.2s ease-in-out;
    vertical-align: middle;
    opacity: 0.3; /* Default state, less visible */
}

.content-container #tournament-results-table thead th .sort-icon svg {
    width: 100%;
    height: 50%; /* Each arrow takes half the height */
    stroke: #ffffff;
    transition: opacity 0.2s;
}

/* State when a column is sorted */
.content-container #tournament-results-table thead th.sorted .sort-icon {
    opacity: 1; /* More visible when active */
}

/* Hide the down arrow when sorted ascending */
.content-container #tournament-results-table thead th.sorted.asc .sort-icon .down-arrow {
    opacity: 0;
}

/* Hide the up arrow when sorted descending */
.content-container #tournament-container #tournament-results-table thead th.sorted.desc .sort-icon .up-arrow {
    opacity: 0;
}

.content-container #tournament-results-table tbody tr {
    background-color: #111;
    transition: background-color 0.2s;
}

.content-container #tournament-results-table tbody tr:nth-child(even) {
    background-color: #1a1a1a;
}

.content-container #tournament-results-table tbody tr:hover {
    background-color: #404040;
}

.content-container #tournament-results-table td {
    padding: 1rem;
    color: #e0e0e0;
    border-bottom: 1px solid #444;
    text-align: center;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* Specific styling for the columns */
.content-container #tournament-results-table th[data-column-name="Event"],
.content-container #tournament-results-table td.event-cell {
    min-width: 150px;
    white-space: normal;
}

.content-container #tournament-results-table th[data-column-name="Date"],
.content-container #tournament-results-table td.date-cell {
    white-space: nowrap;
}

.content-container #tournament-results-table th[data-column-name="Entrants"],
.content-container #tournament-results-table td.entrants-cell {
    white-space: nowrap;
}

.content-container #tournament-results-table th[data-column-name="Player"],
.content-container #tournament-results-table td.player-cell {
    min-width: 200px;
}

.content-container #tournament-results-table th[data-column-name="Finish"],
.content-container #tournament-results-table td.finish-cell {
    white-space: nowrap;
}

.content-container #tournament-results-table .player-info {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    text-align: left;
}

.content-container #tournament-results-table .player-photo {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid transparent;
    transition: box-shadow 0.3s ease-in-out;
}

.content-container #tournament-results-table tr:hover .player-photo {
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
}

.rank-1 td { background-color: #ffd70030; color: gold; text-shadow: 0 0 4px gold; }
.rank-2 td { background-color: #c0c0c030; color: silver; text-shadow: 0 0 4px silver; }
.rank-3 td { background-color: #cd7f3230; color: #cd7f32; text-shadow: 0 0 4px #cd7f32; }
.rank-4 td { background-color: #4b371c30; color: #8c7359; text-shadow: 0 0 4px #8c7359; }
.rank-5 td { background-color: #36454F30; color: #b0c4de; text-shadow: 0 0 4px #b0c4de; }
.ranked-6-40 td { background-color: rgba(0, 61, 41, 0.6); color: #d5e8d8; text-shadow: 0 0 4px #b8d9bf; }

.rank-1 .player-photo { box-shadow: 0 0 6px 1px gold; }
.rank-2 .player-photo { box-shadow: 0 0 6px 1px silver; }
.rank-3 .player-photo { box-shadow: 0 0 6px 1px #cd7f32; }
.rank-4 .player-photo { box-shadow: 0 0 6px 1px #8c7359; }
.rank-5 .player-photo { box-shadow: 0 0 6px 1px #b0c4de; }
.ranked-6-40 .player-photo { box-shadow: 0 0 6px 1px #b8d9bf; }
.ranked-6-40 tr:hover .player-photo { box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5); }

.pagination-info-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: 1rem;
    gap: 0.5rem;
}

.content-container .pagination-container {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
}

.content-container .pagination-btn {
    background-color: #444;
    color: #fff;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.content-container .pagination-btn:hover:not(:disabled) {
    background-color: #555;
}

.content-container .pagination-btn:disabled {
    background-color: #333;
    color: #666;
    cursor: not-allowed;
}

.content-container #page-info {
    font-size: 1.25rem;
    font-weight: bold;
    color: #FF5E13;
    text-shadow: 0 0 5px rgba(255, 94, 19, 0.75);
    text-align: center;
}

/* --- Mobile-only Styles (768px and below) --- */
.mobile-only-controls {
    display: none;
}

@media (max-width: 768px) {
    .content-container {
        padding: 1rem;
    }

    .content-container h1 {
        font-size: 1.5rem;
    }

    .content-container #search-input {
        font-size: 0.9rem;
    }

    .content-container #tournament-results-table {
        border-collapse: separate;
        border-spacing: 0 10px;
    }

    .content-container #tournament-results-table thead {
        display: none;
    }

    .content-container #tournament-results-table,
    .content-container #tournament-results-table tbody,
    .content-container #tournament-results-table tr {
        display: block;
        width: 100%;
    }

    .content-container #tournament-results-table tr {
        margin-bottom: 0.75rem;
        border-radius: 8px;
        overflow: hidden;
        border: 1px solid #444;
        cursor: pointer;
    }

    .content-container #tournament-results-table td {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #444;
        padding: 1rem;
        text-align: right;
        white-space: normal;
    }

    .content-container #tournament-results-table td::before {
        content: attr(data-label);
        font-weight: bold;
        color: #aaa;
        text-align: left;
        flex-basis: 40%;
    }

    .content-container #tournament-results-table td.primary-info-cell {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .content-container #tournament-results-table td.secondary-info-cell {
        display: none;
    }
    
    .content-container #tournament-results-table tr.expanded td.secondary-info-cell {
        display: flex;
    }

    .content-container #tournament-results-table td:first-of-type {
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
    }

    .content-container #tournament-results-table td:last-of-type {
        border-bottom-left-radius: 8px;
        border-bottom-right-radius: 8px;
    }
    
    .content-container #tournament-results-table tr.expanded td:last-of-type {
        border-bottom: none;
    }
    .content-container #tournament-results-table tr:not(.expanded) .secondary-info-cell:first-of-type {
        border-top-left-radius: 0;
        border-top-right-radius: 0;
    }

    .content-container #tournament-results-table tr.expanded .secondary-info-cell:first-of-type {
        border-top-left-radius: 0;
        border-top-right-radius: 0;
    }

    .content-container #tournament-results-table .player-info {
        flex-grow: 1;
        justify-content: flex-end;
    }
    
    .mobile-only-controls {
        display: block;
    }

    .mobile-sort-btn {
        display: block;
        width: calc(100% - 2rem);
        max-width: 400px;
        margin: 1.5rem auto;
        padding: 0.75rem;
        font-size: 1rem;
        font-weight: bold;
        color: #fff;
        background-color: #FF5E13;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .mobile-sort-btn:hover {
        background-color: #cc4b0f;
    }

    .sort-modal {
        display: none; /* Hidden by default */
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(5px);
    }

    .modal-content {
        background-color: #222;
        color: #fff;
        padding: 2rem 1rem;
        border-top-left-radius: 12px;
        border-top-right-radius: 12px;
        position: absolute;
        bottom: 0;
        width: 100%;
        box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.5);
        transform: translateY(100%);
        transition: transform 0.4s ease-out;
    }

    .sort-modal.show .modal-content {
        transform: translateY(0);
    }

    .modal-content h2 {
        text-align: center;
        margin-top: 0;
        color: #FF5E13;
    }

    .close-btn {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        position: absolute;
        top: 10px;
        right: 20px;
        cursor: pointer;
    }

    .close-btn:hover,
    .close-btn:focus {
        color: #fff;
    }

    .sort-options .sort-option-btn {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        padding: 1rem;
        margin-bottom: 0.5rem;
        background-color: #444;
        border: none;
        border-radius: 8px;
        color: #fff;
        font-size: 1rem;
        cursor: pointer;
        transition: background-color 0.2s;
    }

    .sort-options .sort-option-btn.active {
        background-color: #FF5E13;
    }

    .sort-options .sort-option-btn:hover {
        background-color: #555;
    }

    .sort-options .sort-option-btn.active:hover {
        background-color: #cc4b0f;
    }
    
    /* Mobile sort icon opacity changes to match the new style */
    .sort-options .sort-option-btn.active .sort-icon .down-arrow {
        opacity: 0;
    }
    .sort-options .sort-option-btn.active .sort-icon .up-arrow {
        opacity: 0;
    }
    .sort-options .sort-option-btn.active.asc .sort-icon .up-arrow {
        opacity: 1;
    }
    .sort-options .sort-option-btn.active.desc .sort-icon .down-arrow {
        opacity: 1;
    }
}
</style>

<div class="content-container">
    <h1>Tournament Results</h1>
    <div class="controls-container">
        <input type="text" id="search-input" placeholder="Search by Player or Event..." title="Type to search for a player or event.">
    </div>

    <div class="mobile-only-controls">
        <button id="mobile-sort-btn" class="mobile-sort-btn">Sort By</button>
        <div id="sort-modal" class="sort-modal">
            <div class="modal-content">
                <span class="close-btn">&times;</span>
                <h2>Sort Results</h2>
                <div id="sort-options" class="sort-options">
                </div>
            </div>
        </div>
    </div>

    <div class="table-wrapper">
        <table id="tournament-results-table">
            <thead>
                <tr>
                    <th data-column-name="Event" data-type="string">Event
                        <span class="sort-icon">
                            <svg class="up-arrow" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="18 15 12 9 6 15"/>
                            </svg>
                            <svg class="down-arrow" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="6 9 12 15 18 9"/>
                            </svg>
                        </span>
                    </th>
                    <th data-column-name="Date" data-type="string">Date
                        <span class="sort-icon">
                            <svg class="up-arrow" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="18 15 12 9 6 15"/>
                            </svg>
                            <svg class="down-arrow" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="6 9 12 15 18 9"/>
                            </svg>
                        </span>
                    </th>
                    <th data-column-name="Entrants" data-type="number">Entrants
                        <span class="sort-icon">
                            <svg class="up-arrow" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="18 15 12 9 6 15"/>
                            </svg>
                            <svg class="down-arrow" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="6 9 12 15 18 9"/>
                            </svg>
                        </span>
                    </th>
                    <th data-column-name="Player" data-type="string" class="player-cell">Player
                        <span class="sort-icon">
                            <svg class="up-arrow" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="18 15 12 9 6 15"/>
                            </svg>
                            <svg class="down-arrow" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="6 9 12 15 18 9"/>
                            </svg>
                        </span>
                    </th>
                    <th data-column-name="Finish" data-type="finish">Finish
                        <span class="sort-icon">
                            <svg class="up-arrow" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="18 15 12 9 6 15"/>
                            </svg>
                            <svg class="down-arrow" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="6 9 12 15 18 9"/>
                            </svg>
                        </span>
                    </th>
                </tr>
            </thead>
            <tbody id="table-body">
            </tbody>
        </table>
    </div>
    <div class="pagination-info-container">
        <span id="page-info"></span>
        <div class="pagination-container">
            <button id="prev-page-btn" class="pagination-btn">Previous Event</button>
            <button id="next-page-btn" class="pagination-btn">Next Event</button>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const googleSheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQBIqTU9Vjqm4lAYt4gGj4QMaxG4eXSsgbDzi2GVHVvrZX0Dba6b1_SlyrVI9ARnlG-xc_b0NVq5lmU/pub?gid=332201631&single=true&output=csv";
    const googleRankingsURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQBIqTU9Vjqm4lAYt4gGj4QMaxG4eXSsgbDzi2GVHVvrZX0Dba6b1_SlyrVI9ARnlG-xc_b0NVq5lmU/pub?gid=1862929315&single=true&output=csv";

    const tableBody = document.getElementById('table-body');
    const searchInput = document.getElementById('search-input');
    const prevBtn = document.getElementById('prev-page-btn');
    const nextBtn = document.getElementById('next-page-btn');
    const pageInfo = document.getElementById('page-info');
    const sortModal = document.getElementById('sort-modal');
    const closeModalBtn = document.querySelector('.close-btn');
    const sortOptionsContainer = document.getElementById('sort-options');

    let allData = [];
    let groupedDataByEvent = {};
    let uniqueEvents = [];
    let currentEventIndex = 0;
    let searchTerm = '';
    let sortedColumn = 'Finish'; // Default sort on page load
    let sortDirection = 'asc';
    let rankingsMap = {};
    let playerIconMap = {};

    function sortData(data, column, type, direction) {
        if (!data || !column) {
            return data;
        }
        const order = direction === 'asc' ? 1 : -1;
        return data.sort((a, b) => {
            const valA = a[column];
            const valB = b[column];

            if (type === 'finish') {
                const numA = parseFloat(valA.replace('st', '').replace('nd', '').replace('rd', '').replace('th', ''));
                const numB = parseFloat(valB.replace('st', '').replace('nd', '').replace('rd', '').replace('th', ''));
                if (!isNaN(numA) && !isNaN(numB)) {
                    const finishComparison = (numA - numB) * order;
                    if (finishComparison !== 0) {
                        return finishComparison;
                    }
                    const dateA = new Date(a.Date);
                    const dateB = new Date(b.Date);
                    return (dateB - dateA);
                }
            } else if (type === 'number') {
                return (valA - valB) * order;
            }

            if (valA < valB) return -1 * order;
            if (valA > valB) return 1 * order;
            return 0;
        });
    }

    async function fetchData() {
        try {
            await fetchRankings();
            const response = await fetch(googleSheetURL);
            if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
            const text = await response.text();
            allData = parseCSV(text);
            groupDataByEvent(allData);
            renderAll();
        } catch (error) {
            console.error("Error fetching data:", error);
            tableBody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: red;">Failed to load data. Please try again later.</td></tr>';
        }
    }

    async function fetchRankings() {
        try {
            const response = await fetch(googleRankingsURL);
            if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
            const text = await response.text();
            const lines = text.trim().split('\n');
            if (lines.length <= 1) return;

            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            const playerHeader = headers.find(h => h.toLowerCase().includes('player') || h.toLowerCase().includes('name'));
            const rankingHeader = headers.find(h => h.toLowerCase().includes('ranking') || h.toLowerCase().includes('rank'));
            const iconHeader = headers.find(h => h.toLowerCase().includes('icon') || h.toLowerCase().includes('photo'));

            if (!playerHeader || !rankingHeader || !iconHeader) {
                console.error("Could not find 'Player', 'Ranking', or 'Player Icon' headers in the CSV data.");
                return;
            }

            const rankingsData = lines.slice(1).map(line => {
                const values = line.split(',').map(v => v.trim().replace(/"/g, ''));
                const row = {};
                headers.forEach((h, i) => row[h] = values[i]);
                return row;
            }).filter(row => row[playerHeader] && row[rankingHeader] !== '');

            rankingsMap = rankingsData.reduce((acc, current) => {
                const playerName = current[playerHeader];
                const playerRank = parseInt(current[rankingHeader], 10);
                if (playerName && !isNaN(playerRank)) {
                    acc[playerName] = playerRank;
                }
                return acc;
            }, {});

            playerIconMap = rankingsData.reduce((acc, current) => {
                const playerName = current[playerHeader];
                const playerIconUrl = current[iconHeader];
                if (playerName && playerIconUrl) {
                    acc[playerName] = playerIconUrl;
                }
                return acc;
            }, {});
        } catch (error) {
            console.error("Error fetching rankings data:", error);
        }
    }

    function renderAll() {
        let dataToRender = [];

        if (searchTerm) {
            dataToRender = allData.filter(item => {
                const eventName = (item.Event || '').toLowerCase();
                const playerName = (item.Player || '').toLowerCase();
                return eventName.includes(searchTerm) || playerName.includes(searchTerm);
            });
        } else {
            const currentEventName = uniqueEvents[currentEventIndex];
            dataToRender = [...(groupedDataByEvent[currentEventName] || [])];
        }

        const headerElement = document.querySelector(`[data-column-name="${sortedColumn}"]`);
        const sortedType = headerElement ? headerElement.getAttribute('data-type') : null;
        dataToRender = sortData(dataToRender, sortedColumn, sortedType, sortDirection);

        renderTable(dataToRender);
        updatePaginationControls(dataToRender.length);
        updateHeaderIcons();
    }

    function renderTable(data) {
        tableBody.innerHTML = '';
        if (!data || data.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="5" style="text-align: center;">No results found.</td></tr>';
        } else {
            data.forEach(item => {
                const row = document.createElement('tr');
                let playerText = item.Player || '';
                const playerRank = rankingsMap[playerText];

                const shouldShowRankAndPhoto = playerRank >= 1 && playerRank <= 40;
                const playerPhotoUrl = playerIconMap[playerText];

                if (shouldShowRankAndPhoto) {
                    if (playerRank === 1) row.classList.add('rank-1');
                    else if (playerRank === 2) row.classList.add('rank-2');
                    else if (playerRank === 3) row.classList.add('rank-3');
                    else if (playerRank === 4) row.classList.add('rank-4');
                    else if (playerRank === 5) row.classList.add('rank-5');
                    else if (playerRank >= 6 && playerRank <= 40) row.classList.add('ranked-6-40');
                }

                const playerPhotoHtml = (shouldShowRankAndPhoto && playerPhotoUrl) ?
                    `<img src="${playerPhotoUrl}" alt="${item.Player}" class="player-photo">` :
                    '';

                const playerContent = `
                    <div class="player-info">
                        ${playerPhotoHtml}
                        <span>${item.Player || ''} ${shouldShowRankAndPhoto ? `(#${playerRank})` : ''}</span>
                    </div>
                `;

                // Check screen width to determine rendering order
                if (window.innerWidth <= 768) {
                    // Mobile-first order
                    row.innerHTML = `
                        <td data-label="Event" class="event-cell primary-info-cell">${item.Event || ''}</td>
                        <td data-label="Player" class="player-cell primary-info-cell">${playerContent}</td>
                        <td data-label="Finish" class="finish-cell primary-info-cell">${item.Finish || ''}</td>
                        <td data-label="Date" class="date-cell secondary-info-cell">${formatDate(item.Date)}</td>
                        <td data-label="Entrants" class="entrants-cell secondary-info-cell">${item.Entrants || ''}</td>
                    `;
                    row.addEventListener('click', () => {
                        row.classList.toggle('expanded');
                    });
                } else {
                    // Desktop order
                    row.innerHTML = `
                        <td data-label="Event" class="event-cell">${item.Event || ''}</td>
                        <td data-label="Date" class="date-cell">${formatDate(item.Date)}</td>
                        <td data-label="Entrants" class="entrants-cell">${item.Entrants || ''}</td>
                        <td data-label="Player" class="player-cell">${playerContent}</td>
                        <td data-label="Finish" class="finish-cell">${item.Finish || ''}</td>
                    `;
                }
                
                tableBody.appendChild(row);
            });
        }
    }

    function updateHeaderIcons() {
        const headers = document.querySelectorAll('.content-container #tournament-results-table thead th');
        headers.forEach(header => {
            const columnName = header.getAttribute('data-column-name');
            header.classList.remove('sorted', 'asc', 'desc');

            if (columnName === sortedColumn) {
                header.classList.add('sorted', sortDirection);
            }
        });
    }

    function updatePaginationControls(filteredCount) {
        if (searchTerm) {
            pageInfo.textContent = `Showing ${filteredCount} results`;
            prevBtn.disabled = true;
            nextBtn.disabled = true;
        } else {
            const totalEvents = uniqueEvents.length;
            if (totalEvents > 0) {
                pageInfo.textContent = `Event: ${uniqueEvents[currentEventIndex]} (${currentEventIndex + 1} of ${totalEvents})`;
            } else {
                pageInfo.textContent = '';
            }
            prevBtn.disabled = currentEventIndex === 0;
            nextBtn.disabled = currentEventIndex === totalEvents - 1 || totalEvents === 0;
        }
    }

    function formatDate(dateString) {
        if (!dateString) return '';
        const date = new Date(dateString);
        if (isNaN(date.getTime())) return dateString;
        const options = { year: 'numeric', month: 'short', day: 'numeric' };
        return date.toLocaleDateString('en-US', options);
    }

    function parseCSV(text) {
        const lines = text.trim().split('\n');
        if (lines.length <= 1) return [];
        const headers = lines[0].split(',').map(header => header.trim().replace(/"/g, ''));
        const data = lines.slice(1).map(line => {
            const values = line.split(',').map(value => value.trim().replace(/"/g, ''));
            const row = {};
            headers.forEach((header, i) => {
                row[header] = values[i];
            });
            return row;
        }).filter(row => row.Player && row.Player !== '');
        return data;
    }

    function groupDataByEvent(data) {
        const groupedData = {};
        const eventDates = {};
        data.forEach(row => {
            const eventName = row.Event;
            if (eventName) {
                if (!groupedData[eventName]) {
                    groupedData[eventName] = [];
                    eventDates[eventName] = new Date(row.Date);
                }
                groupedData[eventName].push(row);
            }
        });
        groupedDataByEvent = groupedData;
        uniqueEvents = Object.keys(groupedData).sort((a, b) => eventDates[b] - eventDates[a]);
    }

    const headers = document.querySelectorAll('.content-container #tournament-results-table thead th');
    headers.forEach(header => {
        header.addEventListener('click', () => {
            const columnName = header.getAttribute('data-column-name');
            if (sortedColumn === columnName) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortedColumn = columnName;
                if (columnName === 'Date' || columnName === 'Entrants') {
                    sortDirection = 'desc';
                } else {
                    sortDirection = 'asc';
                }
            }
            renderAll();
        });
    });

    searchInput.addEventListener('input', (e) => {
        searchTerm = e.target.value.toLowerCase();
        renderAll();
    });

    prevBtn.addEventListener('click', () => {
        if (currentEventIndex > 0) {
            currentEventIndex--;
            renderAll();
        }
    });

    nextBtn.addEventListener('click', () => {
        if (currentEventIndex < uniqueEvents.length - 1) {
            currentEventIndex++;
            renderAll();
        }
    });

    // New Mobile Sort Functionality
    document.getElementById('mobile-sort-btn').addEventListener('click', () => {
        generateSortOptions();
        sortModal.style.display = 'block';
        setTimeout(() => sortModal.classList.add('show'), 10);
    });

    closeModalBtn.addEventListener('click', () => {
        sortModal.classList.remove('show');
        setTimeout(() => sortModal.style.display = 'none', 400);
    });

    window.addEventListener('click', (event) => {
        if (event.target === sortModal) {
            sortModal.classList.remove('show');
            setTimeout(() => sortModal.style.display = 'none', 400);
        }
    });

    function generateSortOptions() {
        sortOptionsContainer.innerHTML = '';
        const columns = document.querySelectorAll('#tournament-results-table thead th');

        columns.forEach(header => {
            const columnName = header.getAttribute('data-column-name');
            const columnType = header.getAttribute('data-type');
            const displayName = header.textContent.trim().replace(/\s*$/, '');

            const sortBtn = document.createElement('button');
            sortBtn.textContent = displayName;
            sortBtn.classList.add('sort-option-btn');
            
            // Adding the new SVG icons for the mobile modal
            const sortIcon = document.createElement('span');
            sortIcon.classList.add('sort-icon');
            sortIcon.innerHTML = `
                <svg class="up-arrow" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="18 15 12 9 6 15"/>
                </svg>
                <svg class="down-arrow" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="6 9 12 15 18 9"/>
                </svg>`;
            sortBtn.appendChild(sortIcon);

            if (sortedColumn === columnName) {
                sortBtn.classList.add('active', sortDirection);
            }
            
            sortBtn.addEventListener('click', () => {
                if (sortedColumn === columnName) {
                    sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
                } else {
                    sortedColumn = columnName;
                    if (columnName === 'Date' || columnName === 'Entrants') {
                        sortDirection = 'desc';
                    } else {
                        sortDirection = 'asc';
                    }
                }
                
                // Close modal and render after sorting
                sortModal.classList.remove('show');
                setTimeout(() => {
                    sortModal.style.display = 'none';
                    renderAll();
                }, 400);
            });
            sortOptionsContainer.appendChild(sortBtn);
        });
    }

    fetchData();
});
</script>
{% endblock %}
